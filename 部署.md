# ubuntu下部署

## 安装宝塔控制面板
宝塔官网：http://www.bt.cn

安装命令：
```
wget -O install.sh http://download.bt.cn/install/install-ubuntu.sh && sudo bash install.sh
```

安装完宝塔控制面板之后，登录面板，安装"lnmp"（Linux、Nginx、MySQL、PHP）
> 安装默认的即可

安装宝塔面板，主要是为了方便管理站点，如反向代理、SSL等

## 安装中文字体（非必须，但是建议安装）
有的Linux服务器并没有支持中文字体，需要手动安装。
地址：http://www.hc-cms.com/thread-41-1-1.html

安装命令：
```
apt install ttf-wqy-zenhei
apt install fonts-wqy-microhei
```
安装中文字体支持，主要是为了避免Linux系统不支持中文的时候，导致导出文档的时候出现乱码。

## 安装calibre

calibre官网：https://www.calibre-ebook.com/

安装命令：
```
sudo -v && wget -nv -O- https://download.calibre-ebook.com/linux-installer.py | sudo python -c "import sys; main=lambda:sys.stderr.write('Download failed\n'); exec(sys.stdin.read()); main()"
```

执行下面命令，能看到版本号，表示安装成功。
``` 
ebook-convert --version
```

注意：
- 这里要安装最新版的calibre，执行上述命令，安装的就是最新版的了。
- 如果出现`warning`的提示，直接不用理会即可;`error`级别的提示，网上搜下看下如何解决

`calibre`主要用于将文档导出生成pdf、epub、mobi文档。

本人已经使用Go语言对calibre导出pdf、epub、mobi文档进行了一层封装，欢迎大家给个star ==》https://github.com/TruthHun/converter

### 测试

随便创建一个txt文件
```
echo "Hello BookStack。你好，书栈。" > test.txt
```

转成pdf
```
ebook-covert test.txt test.pdf
```
查看测试的转化效果，主要看下转化的过程中有没有报错，以及转化后的文档有没有出现中文乱码。


## 安装Chrome
直接使用命令一键安装：
```
apt install chromium-browser
```
执行以下命令，如果能打印百度页面代码，则表示安装成功。
``` 
chromium-browser --headless --disable-gpu --dump-dom --no-sandbox https://www.baidu.com
```

这个主要用于在发布文档的时候，渲染未被渲染的markdown文档，以及`强力模式`下的网页采集。


## 安装supervisor

安装命令：
``` 
apt install supervisor
```

判断是否安装成功:
``` 
supervisord --version
```
显示版本号，即表示安装成功。

`supervisor`主要用于将程序加入到系统守护进程

`Supervisord` 安装完成后有两个可用的命令行 supervisord 和 supervisorctl，命令使用解释如下：
- supervisord，初始启动 Supervisord，启动、管理配置中设置的进程。
- supervisorctl stop programxxx，停止某一个进程(programxxx)，programxxx 为 [program:beepkg] 里配置的值，这个示例就是 beepkg。
- supervisorctl start programxxx，启动某个进程
- supervisorctl restart programxxx，重启某个进程
- supervisorctl stop groupworker: ，重启所有属于名为 groupworker 这个分组的进程(start,restart 同理)
- supervisorctl stop all，停止全部进程，注：start、restart、stop 都不会载入最新的配置文件。
- supervisorctl reload，载入最新的配置文件，停止原有进程并按新的配置启动、管理所有进程。
- supervisorctl update，根据最新的配置文件，启动新配置或有改动的进程，配置没有改动的进程不会受影响而重启。

## 部署程序

## 加入系统守护进行

## 配置OSS的图片处理

## 配置第三方登录